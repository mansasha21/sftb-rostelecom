import re

import requests
from bs4 import BeautifulSoup
import pandas as pd
from transliterate import translit


def get_context(url):
    df = pd.DataFrame(
        columns=['city', 'latina_name', 'tariff_name', 'tariff_price', 'tariff_speed', 'wifi_router_price',
                 'is_first_month_free', "is_correct_info", 'additional_info'])
    data_df = pd.read_csv("C:/Users/Sergey/PycharmProjects/RZD_Digital/SFTB/data/train.csv", sep=";")
    from_start = 4050
    all_cities = data_df.city_name.unique().tolist()[from_start:]
    i = from_start
    for city in all_cities:
        if(str(city)=="nan"):
            continue
        my_name = translit(city, "ru", reversed=True, strict=False).replace("'", "").replace(" ", "-").replace(".", ""). \
            replace(",", "").replace('/', '').replace('(', '').replace(')', '').replace('[', '').replace(']', '').replace('«', '').replace('»', '')
        url = "https://" + my_name + ".rt-internet.ru/"
        print(my_name + " " + city)
        page_response = requests.get(url, headers={'User-Agent': 'Mozilla/5.0'}, timeout=15)
        print(page_response)
        page_content = BeautifulSoup(page_response.content, "html.parser")
        # print(page_content)
        reviews_stars_for_page = page_content.find_all("div", class_="tarifscard")
        is_correct = str(page_content).find("самый популярный интернет-провайдер в") != -1
        for review_stars in reviews_stars_for_page:
            price = review_stars.find("div", class_="tarif-ap").text.strip()
            speed = re.findall("\d+", review_stars.find("div", class_="attr-int").text.strip())[0]
            # print(review_stars.find("div", class_="attr-int").text.strip())
            try:
                wifi_router_price = re.findall("\d+", review_stars.find("div", class_="equip-attr").text.strip())[0]
            except:
                wifi_router_price = "-1"
            is_month_free = review_stars.find("div", class_="tarif-comap") is not None
            name = review_stars.find("div", class_="tarifs-name").text.strip()
            try:
                additional_info = \
                str(review_stars.find("div", class_="tarifs-name")).split("data-desc=\"")[1].split("\">")[0]
            except:
                additional_info = ""
            tmp_df = pd.DataFrame([{
                "city": city,
                "latina_name": my_name,
                "tariff_name": name,
                "tariff_price": price,
                "tariff_speed": speed,
                "wifi_router_price": wifi_router_price,
                "is_first_month_free": is_month_free,
                "is_correct_info": is_correct,
                "additional_info": additional_info,
            }])
            df = df.append(tmp_df, ignore_index=True)
        i += 1
        if i % 25 == 0:
            df.to_csv(r"C:\Users\Sergey\PycharmProjects\Test\additional_data_from_" + str(from_start) + "_to_" + str(
                i) + ".csv", index=False)

        print(i)
        # if i == 5:
        #     return df
    return df


df = get_context("https://snt-yujnyy.rt-internet.ru/")



# list of difference with test
# ['Федоровка',
#  'Нововолковский',
#  'Газопровод',
#  'Лазурная',
#  'Стрелецкие Хутора',
#  'Добрынское',
#  'Нагать',
#  'Горяны (Козинское с/пос)',
#  'Сухотинка',
#  'Малая Тросна',
#  'Андромер',
#  'Ленинское (Балтийский с/с)',
#  'Подгородняя Покровка',
#  'Патрикеево',
#  'Новая Целина',
#  'Юг',
#  'Березки',
#  'Чкаловский',
#  'Карапсель',
#  'Малиновое Озеро',
#  'Боевой',
#  'Озерное',
#  'Морозово',
#  'Рыбалово',
#  'Кыра',
#  'Гусельниково',
#  'Онохой-3',
#  'Шерегеш',
#  'Клейзавода',
#  'Астраханка',
#  'Нововоскресеновка',
#  'Тунгор',
#  'Осиновая Речка',
#  'Бачурино',
#  'д/о Плесково',
#  'Дровнино',
#  'Ватутинки',
#  'Некрасово',
#  'Марьино',
#  'Фабричная',
#  'Климатино',
#  'Санаторий Снежка',
#  'Гришина Слобода',
#  'Солигалич',
#  'свх Новоусманский 1 отделение',
#  'Выезд',
#  'Кесова Гора',
#  'Лопушь',
#  'Ташенка',
#  'Ингарь',
#  'Анопино',
#  'Санники',
#  'Беле-Кушальское',
#  'Бутиково',
#  'Пищулино',
#  'Бехтеевка',
#  'Томашевка',
#  'Дюдьково',
#  'Горбачево',
#  'Мокеевское',
#  'Сергиевский',
#  'Черемисиново',
#  'Пегаскино',
#  'Санатория им Цюрупы',
#  'Серебряные Ключи',
#  'Крутые Выселки мкр Солнечный',
#  'Атяевка',
#  'Тюшевка',
#  'Ржевка',
#  'Екимовка',
#  'Малей',
#  'Солопенки',
#  'Еганово',
#  'Торхово',
#  'Ямской',
#  'Вербилово',
#  'Полотняный Завод',
#  'Реткино',
#  'Тростье',
#  'Удельная',
#  'Майдаково',
#  'Клязьминский Городок',
#  'Приозерный',
#  'Ново-Ревякинский',
#  'Труд',
#  'Нечаевские Выселки',
#  'Титовское',
#  'Мольгино',
#  'Нинорово',
#  'Горицкое',
#  'Лутовиново',
#  'Березняки',
#  'Орловка',
#  'Русичи',
#  'Гаврилово',
#  'Леушино Новое',
#  'Мартемьяново',
#  'Кондырева',
#  'Серебряные Пруды',
#  'Великомихайловка',
#  'Николо-Малица',
#  'Маклино',
#  'ХРУСТАЛИ-1',
#  'Бояды (Ленинское с/пос)',
#  'Красный Профинтерн',
#  'Совхоза Рязанский',
#  'Аркатово',
#  'Новосадовый',
#  'Кочина Гора',
#  'Морозовский',
#  'Колос',
#  'Ненашево',
#  'Высокое',
#  'Покорное',
#  'Быковка',
#  'Хрустали мини',
#  'ХРУСТАЛИ-2',
#  'Базулино',
#  'Чуприяновка',
#  'Маклец',
#  'Коржавино',
#  'Левый берег',
#  'Горбуновка',
#  'Лух',
#  'Зяблое',
#  'Прилуки',
#  'Раслово',
#  'Захарьино',
#  'Покрово-Пригородное',
#  'Ломы',
#  'Борищево',
#  'Троекурово',
#  'Ульяново',
#  'Стахановский',
#  'Золотарёво',
#  'Корохоткино',
#  'Селиваново',
#  'Левошево',
#  'Заречье тер.',
#  'Малобыково',
#  'Шестихино',
#  'Относово',
#  'Головщино',
#  'Елдино',
#  'Большая Островня',
#  'Поречье-Рыбное',
#  'снт Лазурное',
#  'Митино',
#  'Лопандино',
#  'Беленькое',
#  'Красный Двор',
#  'Поляна',
#  'Нижние Присады',
#  'Асерхово',
#  'Темкино',
#  'Магалинщина',
#  'Ославское',
#  'Кутуково',
#  'Глинково',
#  'Сильково',
#  'Корсаково',
#  'Недельное',
#  'Колосово',
#  'Большетроицкое',
#  'Свень',
#  'Нижняя Ведуга',
#  'Сдт Утес',
#  'Малое Филимоново',
#  'Большая Каменка',
#  'Ерденевский',
#  'Апаницыно',
#  'Старцево',
#  'Садоводческое общество Сокол-3',
#  'Селезни',
#  'Старое Мелково',
#  'Нерль',
#  'Кадом',
#  'Тимошиха',
#  'Буньково',
#  'Новая Таволжанка',
#  'Кореневщина',
#  'Стабна',
#  'Погореловка',
#  'Супонево',
#  'Вига',
#  'Плещеево',
#  'Волоть',
#  'Нижние Велеми',
#  'Заборное',
#  'Дубовичье',
#  'Боброво',
#  'Монино',
#  'Луч',
#  'Козьи горы',
#  'Люторичи',
#  'Старый Город',
#  'Плехановское лесничество Ленинский лесхоз',
#  'Брянск-4',
#  'Пушкари',
#  'Упертовка',
#  'Букань',
#  'Оленьковский',
#  'Березовский Рядок',
#  'Гремячее',
#  'Ясеновая',
#  'Оболенское',
#  'Секиотово',
#  'Демушкино',
#  'Малая Колчева',
#  'Зелёный Шум',
#  'Бутово',
#  'Барбино',
#  'Смычка',
#  'Корневое',
#  'Красное Знамя',
#  'Большие Калмыки',
#  'Митинка (Спас-Загорье)',
#  'Ключ Жизни',
#  'Крутово',
#  'Шуркино',
#  'Витка',
#  'Харлово',
#  'Никулино (Лычевская волость)',
#  'Матросы',
#  'Шлиссельбург',
#  'Коккорево КП Ближняя пристань',
#  'Сярьги',
#  'Репино',
#  'Коврово',
#  'Шоссейное',
#  'Белый ручей',
#  'Луусалми',
#  'Бугрино',
#  'Ивантеево',
#  'Новое Кунино',
#  'Большое Поле',
#  'Царицыно Озеро',
#  'Лаголово',
#  'Отважное',
#  'Ушаки',
#  'Истровка',
#  'Мелегежская Горка',
#  'Озерки(Первомайская)',
#  'Лука',
#  'Ульяновщина',
#  'Кусино',
#  'Рубцово',
#  'Селище',
#  'Чагода',
#  'Анашкино (Артюшинского с/с)',
#  'Куропти',
#  'Бронница',
#  'Невский Парклесхоз',
#  'Килпъявр',
#  'Кривой Порог',
#  '14 км',
#  'Тушитово',
#  'Жеребятьево',
#  'Ракитино',
#  'ТСН Загородное',
#  'Санинская',
#  'Текстильщики',
#  'Новый Свет',
#  'Еловый Бор-1 (Шумское с/п) тер.',
#  'Смолячково',
#  'Устье (Логозовская волость)',
#  'Майкино',
#  'Романово',
#  'Сосновый бор',
#  'Тельмана',
#  'Загорицы',
#  'Рабочеостровск',
#  'Федоровщина',
#  'Большая Климовская',
#  'Черняково',
#  'Вилга',
#  'Мосейково',
#  'Шамокша',
#  'Добровольск',
#  'Штанигурт',
#  'Блохино',
#  'Широкундыш',
#  'Долотково',
#  'Малая Каракша',
#  'Шипово',
#  'Кижеватово',
#  'Кондоль',
#  'Мариинский',
#  'Кирилловка',
#  'Аким-Сергеевка',
#  'Азамай',
#  'Мелюковка',
#  'им Тимирязева (Тимирязевский с/с)',
#  'Селиванкино',
#  'Новая Малыкла',
#  'Ляхово',
#  'Подшивалово',
#  'Васнары',
#  'Кочишево',
#  'Каветка',
#  'Чандар',
#  'Старый Чультем',
#  'Усовы',
#  'Малый Суходол (Федуринский с/с)',
#  'Комсомолец',
#  'к.п. Белая Усадьба',
#  'Кошелевка',
#  'Курлаково',
#  'Звягино (Казаковский с/с)',
#  'Алешково',
#  'Люльпаны',
#  'Благословенка',
#  'Яльчики',
#  'Корта',
#  'Кужмара',
#  'Шишовка',
#  'Вурман-Сюктерское',
#  'Большой Карлыган',
#  'Ключево',
#  'Игорвары',
#  'Нижние Памъялы',
#  'Ильмень',
#  'Горшково',
#  'Струково',
#  'Конар',
#  'Машкачи',
#  'Удмуртские Парзи',
#  'Кишкино',
#  'Адамовка',
#  'Темта',
#  'Квасниковка',
#  'Новочишма',
#  'Садгород',
#  'Бибахтино',
#  'Осиновка',
#  'Нурсола (Тумьюмучашское с/п)',
#  'Казаковка',
#  'Стрелка',
#  'Просница',
#  'Косино',
#  'Мишкино',
#  'Масканур',
#  'Головково',
#  'Атюрьево',
#  'Иргиз',
#  'Шудек',
#  'Емангаши',
#  'Скипино (Тимирязевский с/с)',
#  'Былинный',
#  'Парца(Явасское с/п)',
#  'Байсубаково',
#  'Яуши',
#  'Акманай-5 СНО',
#  'Якшур',
#  'Дондыкар',
#  'Старый Аманак',
#  'Созимский',
#  'Белозерки',
#  'Субакаево',
#  'Новая Беденьга',
#  'Безводное',
#  'Беляевская',
#  'Ветлужский',
#  'Исаково',
#  'Нижняя Татья',
#  'Чибирлей',
#  'Вознесенский',
#  'Среднее Азяково',
#  'Водозерье',
#  'Новоянсаитово',
#  'Ковернино',
#  'Кевдо-Мельситово',
#  'Малый Сундырь',
#  'Питерка',
#  'Удмуртские Ключи',
#  'Кривошеевка',
#  'Энгербал',
#  'Боевая Гора',
#  'Пикшень',
#  'Саратеево',
#  'Лубни',
#  'Трускляй',
#  'Первое Мая(МО рп Большое Козино)',
#  'Косолапово',
#  'Бобылевские Выселки',
#  'Пычас',
#  'Барашево',
#  'Микряково',
#  'Шиндыръялы',
#  'Игнатовка',
#  'Нагорена',
#  'Досаево',
#  'Курнино',
#  'Лаптево',
#  'Неверово',
#  'Грахово',
#  'Великополье',
#  'Тужа',
#  'Малое Ибряйкино',
#  'Старая Уда',
#  'Старый Торъял',
#  'Голубьевка',
#  'Сальзигутово',
#  'Уни',
#  'Тарханово (Кумохинский с/с)',
#  'Мурадым',
#  'Мокроносово',
#  'Малый Толкай',
#  'Утечино',
#  'Кутлумбетово',
#  'Алферьевка',
#  'Доскино',
#  'Козловка (Ройкинский с/с)',
#  'Старое Крещено',
#  'Каменное Заделье',
#  'Большие Маламасы',
#  'Стрелецкая',
#  'Июльское',
#  'Аликово',
#  'Мостовое',
#  'Татаренер',
#  'Яраг-Казмаляр',
#  'Красноярская',
#  'Старонижестеблиевская',
#  'Елкин',
#  'Новоселый 1-й',
#  'Евпраксино',
#  'Летник',
#  'Медведовская',
#  'Удобный',
#  'Экспериментальный',
#  'Ахтанизовская',
#  'Волошино',
#  'Новоленинский',
#  'Займо-Обрыв',
#  'Криворожье',
#  'Банниково-Александровский',
#  'Березанская',
#  'Водопадный',
#  'Хлебодарное',
#  'Новозолотовка',
#  'пансионата Южный',
#  'Вершинный',
#  'Яшалта',
#  'Нижнеподпольный',
#  'Новоульяновский',
#  'Хасавюрт',
#  'Трудфронт',
#  'Привольная',
#  'Кумыш',
#  'Верхняя Саниба',
#  'Маячное',
#  'Гуляй-Борисовка',
#  'Азовская',
#  'Маркин',
#  'Курджиново',
#  'Александровка 2-я',
#  'Чумбур-Коса',
#  'Пчеловодный',
#  'Хазар',
#  'Заплавская',
#  'Анастасиевская',
#  'Суадаг',
#  'Бакланники',
#  'Щедрый',
#  'Кизилов',
#  'Краснянка',
#  'Артезиан',
#  'Кумской',
#  'Большой Царын',
#  'МЖС «Наримановская»',
#  'Гривенская',
#  'Пшеничный',
#  'Батарейка',
#  'Успеновка',
#  'Кадамовский',
#  'Рисоопытный',
#  'Возрожденный',
#  'Ир',
#  'Соколовское',
#  'Марс',
#  'Южно-Сухокумск',
#  'Кривов',
#  'Темижбекская',
#  'Красный Бумажник',
#  'Двубратский',
#  'Ботаника',
#  'Кардоникская',
#  'Нижняя Терновка',
#  'Сухореченский',
#  'Ново-Георгиевское',
#  'Екатериновский',
#  'турбазы Приморская',
#  'Байбек',
#  'Воскресенский',
#  'Крынка',
#  'Цаган Аман',
#  'Гиагинская',
#  'Новотроицкий',
#  'Коврино',
#  'Котляревская',
#  'Белокаменка',
#  'Забойский',
#  'Новоукраинское',
#  'Чапаевское',
#  'Татарская Башмаковка',
#  'Федулов',
#  'Иловайский',
#  'Пойменный',
#  'Куртат',
#  'Мелиховская',
#  'Херсонка',
#  'Новолакедемоновка',
#  'Шапошниково',
#  'Раздорский',
#  'Краснодонский',
#  'Тумак',
#  'Кзыл-Аул',
#  'Ермаковская',
#  'Филипповка',
#  'Большой Буртым',
#  'Омутинское',
#  'Сарафаново',
#  'Кичигино',
#  'Сюзянь',
#  'Бардабашка 1',
#  'Аптрякова',
#  'Груни',
#  'Карабаи',
#  'Тишкова',
#  'Усть-Буб',
#  'Стрижово',
#  'Ломаева',
#  'Малый Сарс',
#  'Никольское Раздолье',
#  'Уфимский',
#  'Махнево',
#  'Камаган',
#  'Ашша',
#  'Самарова',
#  'Кармановка',
#  'Бродокалмак',
#  'Коса',
#  'Куминский',
#  'Сывдарма',
#  'Армизонское',
#  'Русское поле',
#  'Северная',
#  'Шатрово',
#  'Калиновский',
#  'Рябины',
#  'Ушакова',
#  'Усолье',
#  'Карандашово',
#  'Трубный',
#  'Сакмары',
#  'Хмелева',
#  'Уксянское',
#  'Садовод',
#  'Ишимово',
#  'Газ-Сале',
#  'Малая Соснова',
#  'Калачик',
#  'Мостовая (Сылвенское с/п)',
#  'Вишневогорск',
#  'Никитино',
#  'Катаево',
#  'Борисово',
#  'Златоруновск',
#  'Чечеул',
#  'Демьяновка',
#  'Панфилово',
#  'Грановщина',
#  'Новый Уоян',
#  'Бекет',
#  'Большой Оеш',
#  'Усть-Баргузин',
#  'Крупской',
#  'Шереметьевка',
#  'Горьковское',
#  'Саломатово',
#  'Кубовинский',
#  'Камышта',
#  'Медяково',
#  'Пайвино',
#  'Казанково',
#  'Улыбино',
#  'Лапшиха',
#  'Прибрежное',
#  'Чулым',
#  'Новоивановский',
#  'Минино',
#  'Замятино',
#  'Большая Роща',
#  'Бочкари',
#  'Громадск',
#  'Астрахановка',
#  'Сенчанка',
#  'Заливино',
#  'Матюшино',
#  'ДНП Усадьба Марьино',
#  'Новоозерный',
#  'Ангоя',
#  '8 Марта',
#  'Темиртау',
#  'Зоркальцево',
#  'Иртышский',
#  'Первый Шаг',
#  'Новоивановский 2-й',
#  'Смоленка',
#  'Свердловский',
#  'Имени Комиссарова',
#  'Верх-Падунский',
#  'Скрипачи',
#  'Чебуренки',
#  'Большой Антибес',
#  'ДНТ Авиатор',
#  'Бабушкин',
#  'Утянка',
#  'ТСН Солнечная поляна (ст Мочище)',
#  'Камышная',
#  'Новый Энхэлук',
#  'Усть-Ишим',
#  'Бурлаки',
#  'Квасовка',
#  'Манжерок',
#  'Терентьевская',
#  'Чунский',
#  'Каз',
#  'Нестериха',
#  'Каргат',
#  'Кривошеино',
#  'Онохой',
#  'Шебалино',
#  'Улеты',
#  'Могойтуй',
#  'Кижинга',
#  'Новогеоргиевка',
#  'Большое Озеро',
#  'Раевка',
#  'Шаралдай',
#  'Тарбагатай',
#  'Хойтобэе',
#  'Тевриз',
#  'Санболи',
#  'Кировское',
#  'Кипарисово',
#  'Козыревск',
#  'Чапчылган',
#  'Юрюнг-Кюель',
#  'Ерофей Павлович',
#  'Кюкей',
#  'Бестях',
#  'Тит-Эбя',
#  'Буюклы',
#  'Этыркэн',
#  'Сидима',
#  'Варфоломеевка',
#  'Лончаково',
#  'Бошняково',
#  'Нюрбачан',
#  'Хочо',
#  'Запорожье',
#  'Оремиф',
#  'Староварваровка',
#  'Косицино',
#  'Гастелло',
#  'Певек',
#  'База Дрофа',
#  'Большие Санники',
#  'Тумул',
#  'Южные Коряки',
#  'Дуэ',
#  'Ракушка',
#  'Арга',
#  'Мариинский Рейд',
#  'Чир-Унвд',
#  'Бердигестях',
#  'Среднебелая',
#  'Ляличи',
#  'Дальневосточная МИС',
#  'Иркир',
#  'Чаппанда',
#  'Хоро',
#  'Тамбовка',
#  'Посьет',
#  'Бысыттах',
#  'Пожарское',
#  'Белоногово',
#  'Ягодный',
#  'Апача',
#  'Первая Падь']